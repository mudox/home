#!/usr/bin/env bash
set -euo pipefail

source ~/Git/dot-files/bash/lib/jack

tput civis
trap 'tput cnorm' EXIT

# client size
set +u
if [[ -n "$TMUX" ]]; then
  client_width="$(tmux list-clients -t '.' -F '#{client_width}')"
  client_height="$(tmux list-clients -t '.' -F '#{client_height}')"
else
  client_height=$(tput lines)
  client_width=$(tput cols)
fi
set -u

session_name='Homepage'
if tmux has-session -t ${session_name} &>/dev/null; then
  echo "session [${session_name}] already exisits, kill it!"
  tmux kill-session -t "${session_name}"
fi

#
# window: Config
#
jackProgress 'Creating window [Config] ...'

root="${HOME}/Sites/home/"
window_name='Config'
window="${session_name}:${window_name}"
tmux new-session       \
  -s "${session_name}" \
  -n "${window_name}"  \
  -x "$client_width"   \
  -y "$client_height"  \
  -c "${root}"         \
  -d
sleep 0.1
tmux send-keys -t "${window}" "
vv config.toml
"

#
# window: Server
#
jackProgress 'Creating window [Server] ...'

root="${HOME}/Sites/home/"
window_name='Server'
window="${session_name}:${window_name}"
tmux new-window              \
  -a                         \
  -t "${session_name}:{end}" \
  -n "${window_name}"        \
  -c "${root}"               \
  -d
sleep 0.1
tmux send-keys -t "${window}" "
hugo server -DFE -d build/develop --gc --cleanDestinationDir=true
"

#
# window: Content
#
jackProgress 'Creating window [Content] ...'

root="${HOME}/Sites/home/content"
window_name='Content'
window="${session_name}:${window_name}"
tmux new-window              \
  -a                         \
  -t "${session_name}:{end}" \
  -n "${window_name}"        \
  -c "${root}"               \
  -d
sleep 0.1
tmux send-keys -t "${window}" "
v web -c 'FZF!'
"

#
# window: Layout
#
jackProgress 'Creating window [Layout] ...'

root="${HOME}/Sites/home/themes/natrium/layouts"
window_name='Layout'
window="${session_name}:${window_name}"
tmux new-window              \
  -a                         \
  -t "${session_name}:{end}" \
  -n "${window_name}"        \
  -c "${root}"               \
  -d
sleep 0.1
tmux send-keys -t "${window}" "
v web -c 'FZF!'
"

#
# window: CSS
#
jackProgress 'Creating window [CSS] ...'

root="${HOME}/Sites/home/themes/natrium/static/css"
window_name='CSS'
window="${session_name}:${window_name}"
tmux new-window              \
  -a                         \
  -t "${session_name}:{end}" \
  -n "${window_name}"        \
  -c "${root}"               \
  -d
sleep 0.1
tmux send-keys -t "${window}" "
v web -c 'FZF!'
"

#
# window: JavaScript
#
jackProgress 'Creating window [JavaScript] ...'

root="${HOME}/Sites/home/themes/natrium/static/js"
window_name='JavaScript'
window="${session_name}:${window_name}"
tmux new-window              \
  -a                         \
  -t "${session_name}:{end}" \
  -n "${window_name}"        \
  -c "${root}"               \
  -d
sleep 0.1
tmux send-keys -t "${window}" "
v web -c 'FZF!'
"

jackEndProgress
tmux select-window -t "${session_name}:1.1"
echo "[${session_name}]"
tmux list-window -t "${session_name}" -F ' - #W'
